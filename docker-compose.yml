version: '3.8'

services:
  # === Data Collection ===
  # Usage: docker compose run --rm collect <protocol> [options]
  # Examples:
  #   docker compose run --rm collect celestia --days 1
  #   docker compose run --rm collect near --blocks 5000
  #   docker compose run --rm collect all --days 1
  collect:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: da-research-collect
    volumes:
      - ./protocol:/app/protocol
    environment:
      - PYTHONUNBUFFERED=1
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-}
      - GOOGLE_APPLICATION_CREDENTIALS=${GOOGLE_APPLICATION_CREDENTIALS:-}

  # === Interactive shell ===
  da-research:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: da-research-protocols
    volumes:
      - ./protocol:/app/protocol
    environment:
      - PYTHONUNBUFFERED=1
    working_dir: /app
    stdin_open: true
    tty: true
    entrypoint: /bin/bash

  # Individual protocol services (optional)
  avail:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: da-research-avail
    volumes:
      - ./protocol/avail:/app/protocol/avail
    working_dir: /app/protocol/avail
    environment:
      - PYTHONUNBUFFERED=1
    stdin_open: true
    tty: true
    entrypoint: /bin/bash

  espresso:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: da-research-espresso
    volumes:
      - ./protocol/espresso:/app/protocol/espresso
    working_dir: /app/protocol/espresso
    environment:
      - PYTHONUNBUFFERED=1
    stdin_open: true
    tty: true
    entrypoint: /bin/bash

  near:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: da-research-near
    volumes:
      - ./protocol/near:/app/protocol/near
    working_dir: /app/protocol/near
    environment:
      - PYTHONUNBUFFERED=1
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-}
    stdin_open: true
    tty: true
    entrypoint: /bin/bash

  polkadot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: da-research-polkadot
    volumes:
      - ./protocol/polkadot:/app/protocol/polkadot
    working_dir: /app/protocol/polkadot
    environment:
      - PYTHONUNBUFFERED=1
    stdin_open: true
    tty: true
    entrypoint: /bin/bash

  celestia:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: da-research-celestia
    volumes:
      - ./protocol/celestia:/app/protocol/celestia
    working_dir: /app/protocol/celestia
    environment:
      - PYTHONUNBUFFERED=1
    stdin_open: true
    tty: true
    entrypoint: /bin/bash

  ethereum:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: da-research-ethereum
    volumes:
      - ./protocol/ethereum:/app/protocol/ethereum
    working_dir: /app/protocol/ethereum
    environment:
      - PYTHONUNBUFFERED=1
      - GOOGLE_APPLICATION_CREDENTIALS=${GOOGLE_APPLICATION_CREDENTIALS:-}
    stdin_open: true
    tty: true
    entrypoint: /bin/bash
